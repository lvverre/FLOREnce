#lang br/quicklang
(provide (all-defined-out))
(require "window.rkt")

;Size + time
(define time (minutes: 2))
(define max-size-window 100)
(define size-window 5) 


;ROOT
(define root '())
(define (add-rule-to-root! alpha-node)
  (set! root (cons alpha-node root)))


;FILTER NODE
;(alpha-nodes, join-nodes)
(struct filter-node (partial-matches successors) #:transparent #:mutable)

(define (add-successor-to-node! node new-successor)
  (set-filter-node-successors! node (cons new-successor (filter-node-successors node))))

;ALPHA NODE
(struct alpha-node filter-node ( event-id args (conditions #:mutable)) #:transparent)

(define (make-alpha-node  event-id args conditions)
  (alpha-node (make-window size-window time) '()  event-id args conditions))


;TERMINAL NODE
(struct terminal-node () #:transparent)
(struct empty-t-node terminal-node ())
(define empty-node (empty-t-node))
(struct emit-t-node terminal-node (name args) #:transparent)
(struct retract-t-node terminal-node (name args) #:transparent)



;JOIN-NODE
(struct join-node filter-node (left-activation  right-activation conditions) #:transparent #:mutable)
(define (make-join-node left right condition level)
  (if 
  (join-node (make  left right condition))

